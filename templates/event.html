{% extends "base.html" %}

{% from "shared/_upcoming_session.html" import upcoming_session %}
{% from "_macros/vf_hero.jinja" import vf_hero %}
{% from "_macros/vf_tiered-list.jinja" import vf_tiered_list %}
{% from "shared/_video_card.html" import video_card %}

{% block title %}{{ event.title }} - {{ event.subtitle }} - Canonical Masterclasses{% endblock %}

{% block content %}

  {% call(slot) vf_hero(
    title_text=event.title,
    subtitle_text=event.subtitle,
    layout='50/50',
    is_split_on_medium=true
    ) -%}
    {%- if slot == 'description' -%}

    {%- endif -%}
    {%- if slot == 'cta' -%}
      <a href="{{ event.all_videos_url }}"
         class="p-button--positive">Browse all videos</a>
      {%- if event.live_stream_url -%}
      <a href="{{ event.live_stream_url }}">Join the live stream</a>
      {%- endif -%}
    {%- endif -%}
    {%- if slot == 'image' -%}
      {%- if event.featured_video and event.featured_video.recording -%}
          <iframe
        src="https://drive.google.com/file/d/{{ event.featured_video.recording|google_drive_id }}/preview"
        allow="autoplay"
        allowfullscreen
        class="iframe-video"
      ></iframe>
      {%- else -%}

          {{ image(url="https://assets.ubuntu.com/v1/8f77cc6c-image%2010.png",
            alt="",
            width="1832",
            height="1220",
            hi_def=True,
            loading="auto|lazy"
            ) | safe
          }}
      {%- endif -%}



    {%- endif -%}
  {% endcall -%}

  <div class="p-section">
    <style>
      .video-card {
        height: auto;
      }
    </style>

  {% for day in event.days %}
    {% set session_count = day.sessions | length %}
    {% call(slot) vf_tiered_list(is_list_full_width_on_tablet=false) %}

      {%- if slot == 'title' -%}
        <h2>{{ day.title }}</h2>
      {%- endif -%}

      {% for session in day.sessions %}
        {%- set session_index = loop.index -%}
        {%- set slot_title = 'list_item_title_' ~ session_index -%}
        {%- set slot_desc = 'list_item_description_' ~ session_index -%}

        {%- if slot == slot_title -%}
          <h3 class="p-heading--5">{{ session.title }}</h3>
        {%- endif -%}

        {%- if slot == slot_desc -%}
          {%- if session.videos %}
            {% if session.videos | length > 1 %}
              <!-- Render multiple videos in a row -->
              <div class="grid-row">
                {% for video in session.videos %}
                  <div class="grid-col-2 p-section--shallow">
                    {{ video_card(video) }}
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <!-- Single video card -->
              <div class="p-section--shallow">
                {{ video_card(session.videos[0]) }}
              </div>
            {% endif %}
          {% else %}
              <!-- No videos available -->
              <p class="u-text--muted">No videos available for this session.</p>
          {% endif %}
        {%- endif -%}

      {% endfor %}
    {% endcall %}
  {% endfor %}

  </div>
{% endblock %}
